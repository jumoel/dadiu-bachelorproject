\section{Imachination}
\label{sec:imachination}

Spillet viser produktet af et barns fantasi. Startmenuen viser en
dreng der leger i sin sandkasse. I sin leg skal han grave sig til kina
og for at komme igennem jorden må han bygge en maskine og kæmpe sig
vej mod underlige væsener og andre maskiner.  [Screenshot af progress
gennem jorden] Der er taget udgangspunkt i børns betagelse af store
maskiner. Især drenge er meget fascineret af hvordan maskiner virker,
og det er som regel altid et hit med køretøjer eller maskiner blandt
drengebørn. Vi har i spillet prøvet at opnå en ``wauw'' effekt ved at
se på hvordan børn fantaserer og leger. ``Hvad er endnu bedre end en
kanon, en større kanon''.  Spillet er todelt i en bygge del, hvor man
skal konstruere sin maskine fra forskellige våben, og en ``RTS'' del
hvor spilleren skal manurere sin maskine rundt igennem underjordiske
grotter hvor der skal bekæmpes modstandere.

[Screenshot af garage] Man bygger sin maskine ved at drag-n-droppe
våben ned på ens maskine. Det er ligeledes muligt at fjerne eller
omrokere våben. Man kan rotere sin maskine ved hjælp af pilene i siden
af skærmen, eller ved at trække i maskinen.

[Screenshot af RTS] Man kører ved at holde musen nede og flytte
cursoren i den retning man ønsker at bevæge sig. maskinen roterer hele
tiden for at holde fronten mod cursoren. Det er muligt at trykke på
sig selv og derved affyre sin \textbf{repulsor}, som skubber fjender
væk. Målet er at positionere sigselv så det er muligt at ødelægge de
bygninger der befinder sig rundt i banerne og derefter at besejre
bossen uden at dø.  Alle banerne er firkantede ligesom sandkassen og
hvis man kigger nøge efter kan man se at mange af ikonerne til våben,
fjender og lignende kan findes i startmenuen som viser drengen i
sandkassen.

For at underbygge følelser af at det er et barn der forestiller sig
hele spillet valgte vi at få børn til at indtale alle lydeffekter i
spillet. Det er en håndfuld børn fra det lokale fritidshjem som udover
at teste har indtalt skydelyde, eksplosionslyde og meget mere. Det er
også et syvårigt barn der har indtalt \textbf{voice-over} stemmen til
vores trailer\footnote{http://www.youtube.com/watch?v=WJ-ca5-hhWk} på
engelsk selvom han ikke kunne tale engelsk. Manuskriptet er blevet
læst højt for ham og han er så blevet optaget mens han forsøger at
gentage ordene. Det bidrager til følelsen af at han sidder og leger
for sigselv i sin sandkasse.


\subsection{Forløb}

Før selve produktionen startede, var vi en håndfuld fra gruppen der
satte os ned og snakkede om, hvilken type spil vi kunne lave og
hvilket tema. Vi var en gruppe bestående af vores game director, game
designer, project manager, art director, visual artist og en
programmør. vi fik sorteret i nogle tidlige brainstorm ideer og
fastlagt en mere konkret idé. Det første udkast til spillet startede
som et byggeplads spil. Man var en byggemand der konkurerede mod de
naboliggende byggeprojekter. Man skulle så samtidig med at man byggede
sit eget op sabotere de andres byggeprojekter. Det var først da vi fik
fantasien om at grave sig ned til kineserne ind i konceptet at spillet
ændrede sig markant til at man skulle bekæmpe underjordiske
væsener. Når spillet henvender sig til små børn skal man også passe på
hvad det er man slår og skyder efter. Det er mere acceptabelt at skyde
efter underlige væsener end mennesker.

Den første dag af produktionen blev idéen pitched til hele gruppen. Da
den faldt i god jord sparede vi værdifuld tid i preproduktionen da vi
allerede få timer efter at have mødtes kunne starte på at producere
prototyper.

For programmørenes del startede udviklingen todelt. Da vores spil
består af to vidt forskellige dele, bygge delen og køre delen, og
derfor startede vi med at lave prototyper inddelt i 2 grupper. Sammen
med en anden programmør blev jeg sat til at prototype en kasse der
kunne følge efter musen i et RTS lignende kameraview. De to dele
skulle så senere sættes sammen i spillet.

Vores projekt blev kørt med \textbf{SCRUM} møder hver morgen hvor hver
enkelt fortalte hvad der var blevet lavet dagen før, og hvad der var
planlagt at man skulle bruge dagen på.  Derudover var der ikke meget
styring af udviklingen. Der var lead-møder hvor leads fra hvert felt
snakkede med director, designer og project manager, men udover det var
der ikke meget koordinering. Internt på programmør holdet havde vores
lead et vist overblik over hvor langt vi var nået, men deudover
arbejdede vi bare derudaf.

Vores leadprogrammør forsøgte sig med at sætte post-its op på væggen
med de forskellige opgaver der skulle løses samt en estimeret tid af
ogpaven. Man skulle så tage en post-it når man gik igang med at løse
opgaven og returnere den når man havde fuldført den og notere på den
hvor lang tid det reelt tog at løse opgaven. Systemet gik dødt da det
ikke blev opdateret med nye opgaver gennem projektet. Vi endte med at
holde en bug-liste på et whiteboard som blev opdateret løbende.

Vi arbejde alle 13 i samme rum. Det gav en del støg og det var til
tider svært at koncentrere sig om en enkelt opgave da man tit blev
afbrudt. Til gengæld gav det mulighed for hele tiden at følge med i
hvad andre lavede og gav et godt overblik over projektet selv for dem
der ikke var påkrævet at have overblikket. Det gjrode at artisterne og
programørrerne aldrig gik skævt af hinanden og det var meget nemt at
lave tingene som andre havde forestillet sig det skulle laves, samt
komme med indput og ideer for at hjælpe hinanden.

\subsection{Mit fokus} Ved første udkast var jeg den programmør der
skulle bruge mest tid på KI'en grundet min bacheloropgave. Det var
idéen at jeg ville kunne bruge de to midterste af de fire uger på at
udvikle KI'en til spillet. Det viste sig hurtigt at det var et meget
urealistisk bud da holdet var meget tidspresset af blot at få spillet
færdigt uden advanceret KI. Derfor blev det ikke til så meget KI som
jeg havde håbet, men en del mere implementering af diverse ting til
spillet.

Som førnævnt blev vores prototype udvikling opdelt i to grupper. Jeg
skulle lave vores diablo-lignende bevægelses system, hvor maskinen
skulle følge efter musen hvis man holdt museknappen nede. Det blev
lavet ved at raycaste mod det plan maskinen kører i og derefter hele
tiden at forsøge at rotere maskinen så den vender mod
raycast-hittet. Disse raycasts bliver lavet hver update uanset om
musen er trykket ned eller ej. Hvis man trykker på musseknappen
begynder maskinen at køre i fremadretningen uanset hvilken vej det
måtte være. I den første prototype blev maskinen flyttet med
translateringer, hvilket ødelagde det fysiksystem Unity har
indbygget. Det blev ændret således at maskinen får tilføjet en kraft i
dens fremadretning. Det gjorde derimod at bliven beholder en kraft i
en retning selvom den drejer hvilket får maskinen til at skride
ud. Det er måske meget godt hvis man har en normal bil, men da vores
spil indeholder en stor maskine med larvefødder måtte vi ændre alt
kraft maskinen får fra accelerering til at være i fremadretningen også
selvom denne skulle ændres.  Vi blev også nødt til at begrænse kraften
maskinen kunne få på af y aksen. Det kunne forekomme at bossen og
spilleren fik lavet sammenstød der skabte enorm opdrift. Derfor at der
blot sat en maks begrænsning på hvor meget opdrift maskinen kan have
på et givent tidspunkt. Dette forhindrer maskinen i at flyve højt op
ved mindre der konstant bliver tilføjet kraft til den.

Vi havde gentagne gange testet spillet på børn fra det lokale
fritidshjem og børnene kunne finde ud af at manurere rundt i spillet,
og adspurgt havde de intet at klage over. Alligevel viste det sig at
når voksne spillede spillet følte de ikke at maskinen reagerede helt
som de ville. Det skyldes nok dels at børn er hurtigere til at
acceptere at tingene er som de er, frem for at ville have ting til at
opføre sig som de vil have. Derudover skyldes det nok at børnene gerne
ville være gode til at hjælpe og gode til at spille spillet, så de gav
ikke udtryk for deres problemer på sammen måde. Vi indså derfor at vi
måtte gøre så meget som muligt for at hjælpe spilleren til dels at
vide hvilken vej han kunne forvente at hans maskine ville køre på et
givent tidspunkt, og dels at gøre det nemmere og sjovere at køre.

Da vores styring minder meget om at have en snor bundet fast i
maskinens forende valgte vi at prøve at genskabe denne følelse bedre,
da det var det brugeren forventede. Vi valgte at sætte
drejehastigheden op ud fra hvor stor vinklen var mellem maskinens
fremadretning og den ønskede retning. Hvis man trække maskinen 180
grader modsat af hvor fremadretningen er vil maskinen derfor dreje
meget hurtigt og derved dreje på et lille område selvom der køres
fremad gennem hele svinget, svarende til at man havde en snor bundet
fast i en kasses forende og trak den modsatte vej.

Det viste sig også at være et problem for voksne at se hvilken del af
maskinen der var forenden. På tros af at maskinen altid forsøger at
rotere mod musen. Derfor implementerede vi to styringsplaner omkring
maskinen som indeholder GUI der skal fortælle spilleren hvordan
maskinen vender (det orange lag) samt hvilken retning maskinen
forsøger at dreje imod (den grønne pil).  [muligvis Screenshot af GUI
planer]

Jeg lavede også en del prototyping af våbene til maskinen. Det var den
oprindelige plan at der skulle laves fem våben til at starte med, og
den overskydende til i projektet skulle bruges på at lave flere,
sjovere og skørere våben. Det viste sig dog at der ikke var noget
overskydende tid så dem fem oprindelige våben blev til de endelige
våben. Flammekasteren og saven er lavet med collidere der har en
\textbf{on trigger stay} funktion. Så længe en fjende opholder sig
inde i collideren tager den skade. Dynamitkasteren og gravearmen
bruger begge en sphere collider hhv. fra nedslagspunktet fra
dynamitstangen eller skovlen og jo tættere på centrum en anden
collider befinder sig jo mere skade og jo mere kraft bliver der
tilføjet til fjenden. Dynamitstangen får blot tilføjet en kraft i en
retning og exploderer når den rammer en anden collider. Laseren bruger
raycasting til at se hvad den rammer.

Det blev besluttet af vores lead programmør at vi skulle implementere
en allerede udviklet A\* pathfinding som vi fandt på
nettet. Implementeringen havde både A\* pathfinding samt en modul til
at generere et grid med et nemt brugerinterface. Desværre var det ikke
helt så smertefrit at implementere dette som først antaget. Vi fik
nogle performance problemer og da vi i spillets tredje bane har 50 små
fjender som jagter dig på en gang måtte dele af koden omskrives for at
bruge mindre ressourcer. Det var hovedsageligt selve styrringen /
flytningen af enheder der tog mange kræfter. Derfor er løsningens
originale måde med Unitys \textbf{charactermove} udskiftet med at
bruge fysik til at flytte fjenderne rundt i deres fremadretning. Da
denne løsning ikke kunne bruge knudernes højde og fjenderne derved
f.eks. ikke går op ad bakker men derimod igennem dem brugte vi Unitys
indbyggede funktion til at se hvor højt et terræn er på et givent
punkt. Fjenderne translateres derefter op i y-retningen så de kommer
til at stå oven på terrænet istedet for nede i jorden eller oppe i
luften.

Jeg arbejdede en del sammen med holdets animator da han skulle animere
de små fjender. Når først vi havde overvundet de første problemer med
at få tingene til at spille sammen med Unity så var det ganske nemt at
crossfade mellem animationer og derved få det til at se nogenlunde
glidende ud.

\subsection{Problemer og udfordringer}

Undervejs i projektet gennemgik vores styrringssystem flere
itterationer. Vi havde mange problemer med at få maskinen til at
opføre sig naturligt uden at introdusere nye problemer. F.eks. ville
vi gerne have maskinen til at tippe hvis den holdt på en skrå flade,
men den måtte samtidig ikke kunne tippe hele vejen over. Dette løste
vi ved at fastlåse den maksimale hældning maskinen kan have.

Vi havde også en del problemer med feedback i vores spil. Undervejs i
udviklingen var det en meget tom fornemmelse at køre rundt og skyde
ting. Derfor blev der gjort noget ud af at tilføje feedback til både
våben og fjender. Laseren har fået tilføjet et rekyl så hvis man
sætter flere på den ene siden af maskinen end den anden vil man rykke
til den modsatte side når de skyder. Fjenderne flyver ud af billedet
med ild i halen når de bliver slået ihjel og de hives hvor de kommer
fra skubber en væk når de skyder.

Undervejs i produktionen blev der brugt meget af programmørernes tid
på at hjælpe alle de andre med Unity. Det blev programmørernes opgave
at indsætte alt visuelt og lyd i spillet fordi ingen tidligere havde
fået introduktion til Unity. Det var meget naturligt at det var
programmørerne der fik mest og hurtigst kendskab til Unity og derfor
gik der desværre rigtig meget tid til spilde ved at hjælpe de andre.

\subsection{KI i spillet}

Vores små fjender bruger en simpel A\* pathfinding algoritme. Der
bliver genereret et grid indenfor en boundingbox ved hjælp af
raytracing kastet højt oppe fra. Ved alle intersects bliver der lavet
en knude. Hvis rayen kolliderer med et object tagged som ``wall'' kan
knuden ikke benyttes. Derfor skal alle objecter der ikke kan passeres
\textbf{tagges} som ``wall''.  De finder derefter den korteste vej til
spilleren og roterer så deres \textbf{forward}-vektor peger mod den
næste knude i stien. De bliver hele tiden flyttet frem i deres
fremadretningen. Hvis de vender væk fra den vej de gerne vil bliver
bevægelseshastigheden sat ned proportionalt med vinklen mellem den
ønskede retning og den nuværende retning.  Når en fjende kommer tæt
nok på spilleren stopper den bevægelse mod fremadretningen og roterer
blot mod spilleren samtidig med den angriber.  Oprindeligt var der
lagt op til to typer fjender. Vi ville have implementeret nogle
skydende versioner af de små fjender, sådan at de ikke alle blot løber
hen i døden, men på grund af tidsmangel blev disse fraskrevet.

Vores boss KI bruger samme pathfinding som de små fjender. Den har
blot fået tilføjet en feature hvor den vurderer om den kan ramme med
nogle af dens skydevåben på afstand. Hvis den ser at den kan ramme med
et skydevåben (spilleren er indenfor eller i den rigtige afstand, samt
der kan raycastes direkte hen og ramme spilleren uden at ramme
forhindringer) roterer den således at den får peget et skydevåben i
spillerens retning. Jo længere tid der bliver brugt på at skyde med
skydevåbene jo højere vægt får disse og bossen bliver derfor mere
tilbøjelig til at skifte strategi og køre hen til spilleren og forsøge
at bruge nærkampsvåben. Denne vægt falder så over tid så hvis man
kører væk fra bossen skifter han taktik til igen at skyde efter en.

I det originale design var det meningen at vi ville have implementeret
seek and flee, samt en vægtning af våben så bossen kunne se om han var
stærkere i nærkamp end dig og ligeledes på afstand. På grund af
tidsmangel i projektet blev disse ting dog skåret fra, for da spillet
henvender sig til 6-7 årige børn vurderede holdet at der var lille
udbytte i at have disse features frem for andre.

Vores små fjender er dem der skaber liv i banerne. Deres formål er til
dels at jagte spilleren så der kommer masser af bevægelse i spillet,
dels at blive pløjet ned så spilleren får lov at se sine våben udfolde
sig og skyde modstandere. Det er disse fjender som vil skabe
grundlaget for afprøvningen af KI'en i spillet da det er disse som
skaber mulighederne for både alternativt gameplay samt guider
spilleren hen mod de hives der spawner fjenderne og derved leder
spilleren mod dens mål. Hvis der havde været mere tid til projektet
havde disse fjender været en oplagt mulighed at udvide. Sammen med nye
våben kunne de f.eks. dø på forskellige måder alt efter hvilket våben
de er blevet skudt med og derved give en masse feedback til spilleren.

Bossen spiller to roller. Den ene rolle er udfordringen som du skal
overkomme for at gøre dig fortjent til at spille næste bane. Da de små
fjender dør ekstremt let er det en smule mere tilfredsstillende at få
lov til at slå en lidt større maskine ihjel. Derudover giver bossen et
nyt våben som belønning hvis det lykkedes spilleren at vinde kampen.
Den anden rolle bossen spiller er en form for tips og tricks til
spilleren. Da der i spillet ikke er en særlig god tutorial har bossen
også til formål at vise et eksempel på hvordan man kunne bygge sin
maskine.

\subsection{konklussion på produktet} Der er en masse ting i
udviklingsprocessen der kunne være gjort anderledes og
bedre. F.eks. ville det have været godt med lidt mere planlægning i
udviklingen blandt programmørerne. Der er også flere ting i spillet
som kunne være blevet forbedret. Med nogle ting så som styringen var
vi hæmmet af de krav der var blevet udstedt fra DADIUs side, men andre
ting såsom flere våben, bedre feedback og mere variet gameplay gennem
de forskellige baner kunne være opnået ved at have lidt længere tid
til at udvikle.  I sidste ende er det dog et meget fint produkt vi har
fået skabt på meget kort tid. Det har potentiale til at blive rigtig
godt hvis der udvikles videre på det. Vi fik også meget positiv
respons på spillet til evaluering på DADIU og alle tre dommere så
potentiale i spillet. Det blev enda nævnt at vi skulle ændre
aldersgruppen 30 år op så de også kunne få lov at spille spillet.
	



%%% Local Variables: %%% mode: latex %%% TeX-master: "../../report"
%%% End:
