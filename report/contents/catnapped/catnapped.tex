\section{Catnapped: The Bear Affair}
\label{sec:catnapped}

\subsection{Spillet}

Catnapped er en historie om en teddybamse og en kat fortalt gennem et
spil. De to bor i samme hus og rivaliserer om at få kærligheden fra
drengen, der bor der.

Spillet begynder med at katten fanger vores hovedperson Teddy og
putter ham i vaskemaskinen. Nu gælder det om som spiller at få styret
Teddy gennem en række udfordringer i kampen for at undslippe den onde
kat.

Den første bane udspiller sig i vaskemaskinen, hvor man langsomt
bliver hvirvlet rundt mellem sokkerne. Spilleren skal forsøge at kaste
den snor man har på ryggen, hen på et håndtag inde i vaskemaskinen for
at komme fri.

Næste bane handler om balance. Spilleren skal passere henover brækkede
gulvbrædder uden at falde ned. Bamsen er våd og tung, hvilket gør
styringen vanskelig.

Tredje bane starter med at vise en ventilator der står højt
oppe. Spilleren får fat i ventilatoren med sin snor, og skal modvirke
vindkraften for at trække sig helt tæt på ventilatoren. Når spilleren
er kravlet ned fra ventilatoren, har han en mulighed for at lege lidt
med fysiksystemet, idet han skal bane sig vej til en skakt. 

Nu befinder Teddy sig i en labyrint, som han skal forsøge at
undslippe. For at forhindre dette, forsøger katten at fange spilleren
i lyskeglerne fra dens øjne. Rundt omkring i labyrinten ligger der
tændstikæsker. Disse kan bruges til at gemme sig bag, så katten
ikke ser Teddy. Desuden fungerer de som forhindring da de visse steder
skal skubbes væk, for at Teddy kan komme videre. I labyrinten findes
kakerlakker, der er med til at skabe lidt liv.

Når spilleren er undsluppet fra labyrinten, mødes han med
katten. Katten står oppe på en skammel. Det gælder om at kaste sin
snor på benene så de går i stykker. Der er en \emph{health bar}, der
viser hvor tæt på katten er fra at falde ned. Under kampen forsøger
katten som i labyrinten at fange spilleren med øjnene.

Er spilleren sejrrig, undslipper han og kan i ro og mag sidde i sin
skotøjsæske og blæse sæbebobler til sine dages ende.

\subsection{Produktionsforløb}

Vi brugte første dag i produktionsforløbet på at lære hinanden at
kende. Vi diskuterede hvilke muligheder vi havde for styring af
spillet. Det blev til fire forskellige styringsmetoder. Jeg selv og
vores \emph{lead programmør} var de eneste der ikke havde arbejdet i
Unity3D før. Jeg fik til opgave næste dag at lave en styremåde til
Teddy. Spilleren kunne kigge med musen og rykke sig fremad når venstre
musetast blev holdt nede. Dette var den mest simple styremåde.  Andre
løsninger indebar blandt andet at man skulle bevæge sig rundt som om
man havde vægt på musen: Hvis man holdt den til højre for Teddy ville
han vælte mod højre og gå hurtigere, jo længere væk musen blev
flyttet, indtil han til sidst faldt. Dette princip blev aldrig rigtig
brugt, men det fik os til at komme på de første ideer til spillet. Vi
havde overvejet at Teddy kunne samle ting i huset til et lille
et-bamsesband. Det vil sige at Teddy skulle spille på tingene han
samlede op, for at finde ud af om det var noget han kunne bruge i sit
multiinstrument.

På tredjedagen blev vores endelige ide lagt fast og vi begyndte at
udvikle. Vi skulle nå at lave en masse forskellige prototyper som
vores testgruppe skulle afprøve allerede en uge senere.

For os programmører var der hele tiden noget at se til. Der var mange
baner planlagt fra starten. Det blev programmørernes job at holde styr
på dem alle sammen, sætte dem sammen i Unity og sørge for at de kunne
spilles. For det meste af tiden arbejdede vi på en bane hver. Mit
primære fokus endte med at være labyrint-banen.

Vi havde møder hver morgen på vores produktion. Møderne var en
opdatering om hvad der var sket den foregående dag. Vi havde opsamling
af hvilke nye arbejdsopgaver der var til den kommende dag, så alle
havde mulighed for at finde noget at lave.

\subsection{Mine arbejdsopgaver}

Jeg stod først og fremmest for KI-delen af vores spil. Jeg fik tildelt
ansvaret for vores kunstige intelligens. Det endte dog med at vi havde
svært ved at få noget som helst KI implementeret i spillet. [TODO: INDSÆT
TEKST OM AT HER VIL VI REFERERERERE TIL AFSNIT OM HVORFOR DER IKKE
ENDTE MED AT VÆRE NOGET KI I SPILLET]

I stedet endte mine arbejdsopgaver med at være følgende:

\begin{itemize}
\item Leveldesign i labyrinten
\item Waypoints til de øjne der følger spilleren
\item Implementerede funktionalitet så øjnene kunne fange Teddy
\item Spilmenuen
\item GUI-elementer
\item Diverse lydimplementering
\end{itemize}

\subsection{Brugertest}

Vi testede vores spil på børn mange gange i udviklingsforløbet. Nogle
af børnene var bedre end andre, men de hjalp ofte hinanden. Børnene
havde ikke umiddelbart problemer med at forstå styringsmåden. Det var
dog ikke tilfældet for de voksne, der prøvede spillet. [TODO: INDSÆT
EKSEMPLER HER] [TODO: INDSÆT RESULTATER AF BRUGERTEST HER]

\subsection{Problemer og udfordringer}

En af de største problemer der blev afdækket af vores brugertest var,
at det var svært at finde rundt i labyrinten. Vi startede med et
kamera der hele tiden var bag Teddy. Det medførte at spillerne mistede
orienteringen og farede vild. Vi fandt ud af at vi var nødt til at
have et mere stationært kamera så det var klarere, hvilken vej man
gik. I første udgave roterede kameraet 90 grader ad gangen, men
spillerne blev stadig desorienterede. Banen så for anderledes ud fra
de forskellige vinkler. Derfor endte vi med at fjerne al rotation fra
kameraet og placere det over spilleren. Her fik vi det problem at
kameraet let kom til at være placeret bag væggene i banen, så man ikke
kunne se Teddy. Vi forsøgte at løse dette ved at finde den rigtige
højde for kameraet. Det gjorde at man både fik fornemmelsen af at
kunne se toppen af kasserne men gjorde også at kameraet ikke kom for
langt fra Teddy.

\subsection{KI i spillet}

Det der er i spillet af KI nu er de sæt øjne der er rundt omkring i
labyrint banen. De har nogle bestemte waypoints som de følger rundt på
gulvet for at dække et defineret areal. Disse katteøjne har et field
of vision defineret som en vinkel ud fra hvor de ser. Teddy kan kun
blive opdaget hvis han er inden for dette field of vision. Hver fixed
update bliver der sendt et raycast ud fra der hvor hvert øje
starter. Når der bliver brugt fixed update sker dette ikke i hvert
frame men med en bestemt interval. Dette betyder at det koster det
samme i performance om man har mange eller få frames per second. Dette
raycast bliver sendt mod Teddy, hvis der ikke er noget der står i
vejen for at han bliver ramt, så er det muligt at han kan blive set af
øjnene. Så tjekkes vinklen mellem det raycast og Teddy. Hvis den er
indenfor synsfeltet begynder alarmen at køre og man har 0.5 sekunder
til at nå ud af øjets synsfelt igen.

Øje sættene er kun tændt et ad gangen. Kun det sæt øjne er tændt som
er tættest på Teddy i forholdt til den korteste vej han skal gå for at
møde dem. Dette bliver fundet udfra nogle pathwaypoints som ligger ved
hver skillevej eller sving i labyrinten. Jeg finder ud af hvilket
punkt Teddy er tættest på og det kan så give beskeden direkte videre
til det øje der er tættest på punktet. De tætteste øjne bliver fundet
i steps. Enhver scene har 2 load funktioner, ``Awake()'' og
``Start()''. De bliver kørt efter hinanden, derefter begynder
``Update()'' at køre hvert frame. Som jeg implementerede shortest path
nu kan hvert pathwaypoint maksimalt søge gennem 2 andre pathwaypoints
som de kan se før der skal være et øje. Det at de kan se hinanden er
defineret på om der er nogen væg-kasser imellem eller ej, hvis der
ikke er kan de se hinanden. Dette virker upraktisk men det betyder
samtidig at hele shortest path finding køres i $O(n)$ tid hvor $n$ er
antallet af pathwaypoints. Algoritmen bliver samtidig kun kørt 1
gang. Det vil sige at lige når banen bliver kaldt så kører algoritmen
i sine små iterationer og derefter bliver alle andre end det tætteste
øje deaktiveret.

Det var meningen at alt skulle kunne proceduralt genereres så vi havde
en ny labyrint hver gang man startede på den bane, det blev dog til
for stort et arbejde. Det kunne have været meget mere interessandt, og
alle algoritmerne i labyrinten var derfor lavet efter at kunne bruges
igen og igen lige meget hvilken labyrintopsætning det blev til til sidst.

Vi overvejede på det tidspunkt i udviklingen af spillet at indføre en
ny karakter som skulle hjælpe og guide Teddy rundt i især
labyrinten. Det skulle være et møl som blev tiltrukket af den våde
bamse og som skulle blive hans ven. Møllet kunne flyve og derved se
labyrinten ovenfra, enten skulle man kunne skifte kamera over til den
så man kunne få et lidt større overblik. Men hvis det var blevet til
noget havde møllet fungeret som en KI spiller der hjalp en hvis man
kom for langt ud på et sidespor. Det skulle kunne hjælpe med at finde
vej i labyrinten eller sige pas på hvis man var ved at komme for tæt
på at blive fanget af katteøjnene. Der skulle altså være en muligvis
ikke korteste vej algoritme, men i hvert fald en mulig-vej algoritme
på dette møl som først kunne bruges til at verificere at labyrinten
var gyldig (dvs. at der var en vej fra start til slut) og derefter kan
guide Teddy hvis det tager for lang tid for ham at finde vejen. 

Da vi fandt ud af at vi ikke ville proceduralt generere labyrinten
fjernede vi også møllet som hjælperen og ændrede planen for at få
indført KI i spillet. I stedet skulle jeg implementere flocking på de
kakerlakker der nu bare går rundt i banen. De skulle søge hen mod
Teddy når han kom indenfor en vis radius af dem. Jo flere kakerlakker
der flocker rundt om Teddy jo sværere vil det være at bevæge sig
rundt. Samtidig skulle katteøjnene begynde at følge hurtigere og
hurtigere efter kakerlakkernes ``lyd'' efterhånden som flere af dem
blev samlet på vejen. Dette skulle gøre banen langt sværerere at komme
igennem men samtidig give mulighed for alternativt gameplay. Vi ville
implementere det så man havde en mulighed for at få kakerlakkerne til
at gå væk igen enten ved at træde på dem eller lave en stampefunktion
hvis man klikker direkte på Teddy. Så skulle kakerlakkerne løbe væk i
et par sekunder og hvis man selv kommer udenfor den radius hvor de
finder en i kan man spille videre uforstyrret indtil man løber ind i
flere kakerlakker. Jeg fik desværre aldrig tid til under forløbet at
implementere denne funktionalitet til kakerlakkerne da der var for
meget andet udenoms arbejde. Det var kun fordi jeg meget hurtigt fik
sat kakerlakker ind i spillet med utilregnelig bevægelse at de kom
med.

Vi havde under hele produktionene diskussioner om hvor og hvordan vi
kunne få noget KI inkluderet i vores projekt da det ikke gav mening
rigtigt at have noget som helst af det. Det var rent ekstraarbejde og
ingen af de andre var specielt opsatte på at der skulle god KI med i
spillet da det ikke ville være en essentiel del i det og ikke ville
medvirke stort på spiloplevelsen.

[TODO: HVIS SKYLD VAR DET AT KI'EN SEJLEDE?]

[TODO: REFLEKTERING OVER BRUGERTEST]

[TODO: INDSÆT DETTE I ET AFSNIT OM TING DER KUNNE FORBEDRES:

Til sidst fandt vi ud af at vi burde
have styret kameraet med triggers igennem hele banen for at få det til
at opføre sig optimalt, men det havde vi ikke tid til at
implementere. Som det blev er det kun et problem at se Teddy et enkelt
sted i labyrinten.]

%%% Local Variables: 
%%% mode: latex 
%%% TeX-master: "../../report"
%%% End:
